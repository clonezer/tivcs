<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>ค้นหาเลขที่ใบแจ้งหนี้</title>
        <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <form class="form-wrapper cf">
  	  <input type="text" placeholder="เลขที่ใบแจ้งหนี้..." id="bill" required>
	    <button type="button" name="SEND" value="SEND" id="SEND" onclick="send()">ค้นหา</button>
    </form>
    <div class="response-wrapper">
  		<div id="response"></div>
  	</div>
  <div class="byline"><p>by <a href="https://github.com/clonezer">CloNEz</a></p><p>search box by <a href="http://speckyboy.com/2012/02/15/how-to-build-a-stylish-css3-search-box/">SpeckyBoy</a> featured on <a href="http://thecodeblock.com/search-box-tutorials-using-css3-jquery/">THE CODE BLOCK</a></p></div>
  </body>

  <script type="text/javascript" charset="utf-8">
		(function(_go_) {
			function Sender(url, json, onreadystatechange, ready) {
				console.log('sending..');
				this.url = url;
				this.params = (function(json) {
					var d = new FormData();
					for (var i in json) {
						d.append(i, json[i]);
					}
					return d;
				})(json);
				this.onreadystatechange = onreadystatechange;
				this.ready = ready;
			}

			Sender.prototype.postData = function() {
				var self = this;
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					self.onreadystatechange(xmlhttp);
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
						self.ready(xmlhttp);
					};
				};

				xmlhttp.open('POST', self.url, true);
				xmlhttp.send(this.params);
			};
			_go_.Sender = Sender;
		})(window);

		function send() {

      var re = /\d{10}/;
      var str = document.getElementById('bill').value
      if (re.test(str)) {
        try {
  				new Sender('https://script.google.com/macros/s/AKfycbzizKZV9hAv7WO38-YZvxjc9as3AuVPEc15sKFFs9elz9te_uLu/exec', {
  					'bill' : document.getElementById('bill').value
  				}, function(xmlhttp) {
  					document.getElementById('response').innerHTML = xmlhttp.responseText;
  				}).postData();
  			} catch(e) {
  				document.getElementById('response').innerHTML = e.message;
  			}
      }else {
        document.getElementById('response').innerHTML = "กรุณากรอกตัวเลขให้ถูกต้อง";
      }
		}
	</script>
</html>
